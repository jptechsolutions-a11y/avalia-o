<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banco de Horas | G&G</title>
    <link rel="icon" href="../icon.png" type="image/png"> <!-- ATUALIZADO: Caminho do ícone -->
    
    <!-- Scripts de Estilo e Ícones (Padrão do App) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="../style.css?v=2"> <!-- ATUALIZADO: Caminho do CSS -->
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- NOVO: Chart.js para os gráficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <!-- NOVO: Plugin de % nos gráficos -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>

    <style>
        /* Estilos específicos do banco_horas.html (mantidos) */
        .diff-up {
            color: #dc2626; /* Vermelho (aumentou/piorou) */
            font-weight: bold;
        }
        .diff-down {
            color: #16a34a; /* Verde (diminuiu/melhorou) */
            font-weight: bold;
        }
        .diff-same {
            color: #6b7280; /* Cinza */
        }
        
        /* Estilo para os cards de estatística do dashboard */
        .stat-card-dash .stat-change {
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
    </style>
</head>
<body class="bg-gray-100"> <!-- Classe padrão do app.html -->

    <!-- Shell principal (do app.html) -->
    <div id="appShell" class="h-screen flex flex-col" style="display: none;">

        <!-- Header (Copiado do app.html e adaptado) -->
        <header id="topBar" class="flex-shrink-0">
            <div class="flex items-center gap-4">
                <button id="sidebarToggle" class="btn-icon">
                    <i data-feather="menu" class="h-5 w-5"></i>
                </button>
                <img src="../icon.png" class="h-8 w-auto" alt="Logo G&G"> <!-- ATUALIZADO: Caminho do ícone -->
                <div class="separator"></div>
                <div class="flex flex-col">
                    <span class="text-sm font-semibold text-white" id="topBarProjectName">Sistema G&G</span>
                    <span class="text-xs text-gray-400" id="topBarOrgName">Banco de Horas</span>
                </div>
            </div>
            
            <div class="flex-1 flex justify-center px-8">
                <!-- Espaço vazio central -->
            </div>
            
            <div class="flex items-center gap-4">
                <!-- Botão de "Nova Avaliação" removido -->
                <div id="profileDropdown" class="relative">
                    <button id="profileDropdownButton" class="flex items-center gap-2 rounded-full hover:bg-gray-700 p-1">
                        <img id="topBarUserAvatar" src="https://i.imgur.com/80SsE11.png" class="w-8 h-8 rounded-full object-cover bg-gray-600">
                        <span id="topBarUserName" class="text-sm font-medium text-white hidden md:block">Usuário</span>
                        <i data-feather="chevron-down" class="h-4 w-4 text-gray-400 hidden md:block"></i>
                    </button>
                    <div id="profileDropdownMenu" class="dropdown-menu">
                         <div class="px-4 py-3 border-b border-gray-600">
                            <span class="block text-sm font-medium text-white" id="dropdownUserName">...</span>
                            <span class="block text-xs text-gray-400" id="dropdownUserEmail">...</span>
                        </div>
                        <a href="../home.html" class="dropdown-item"> <!-- ATUALIZADO: Caminho do link -->
                            <i data-feather="home" class="h-4 w-4 mr-2"></i> Voltar (Home G&G)
                        </a>
                        <div class="border-t border-gray-600">
                            <a href="#" class="dropdown-item text-red-400" id="logoutButton">
                                <i data-feather="log-out" class="h-4 w-4 mr-2"></i> Sair
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main System (Copiado do app.html) -->
        <div id="mainSystem" class="flex flex-1 overflow-hidden">

            <!-- Sidebar (Copiado do app.html e adaptado) -->
            <aside class="sidebar collapsed">
                <nav class="p-2 pt-4">
                    <!-- NOVO: Link do Dashboard (agora é o padrão) -->
                    <a href="#dashboard" class="nav-item active" title="Dashboard">
                        <i data-feather="grid" class="h-5 w-5 mr-3"></i> <span class="nav-text">Dashboard</span>
                    </a>
                    <!-- ATUALIZADO: Link do Acompanhamento (agora é o segundo) -->
                    <a href="#acompanhamento" class="nav-item" title="Acompanhamento">
                        <i data-feather="clock" class="h-5 w-5 mr-3"></i> <span class="nav-text">Acompanhamento</span>
                    </a>
                    
                    <!-- **** INÍCIO DA CORREÇÃO DE LAYOUT (PROBLEMA 2) **** -->
                    <!-- Estrutura replicada do app.html -->
                    <div class="mt-4 border-t border-gray-700 pt-2">
                        <span class="p-3 text-xs font-semibold text-gray-500 uppercase nav-text">Administração</span>
                    </div>
                    <a href="#configuracoes" id="configLink" class="nav-item" title="Configurações" style="display: none;"> <!-- Oculto por padrão -->
                        <i data-feather="settings" class="h-5 w-5 mr-3"></i> <span class="nav-text">Configurações</span>
                    </a>
                    <!-- **** FIM DA CORREÇÃO DE LAYOUT **** -->

                     <a href="#" id="logoutLink" class="nav-item" title="Sair">
                        <i data-feather="log-out" class="h-5 w-5 mr-3 text-red-400"></i> <span class="nav-text text-red-400">Sair</span>
                    </a>
                </nav>
            </aside>
            
            <div id="sidebarOverlay"></div>

            <!-- Main Content (Wrapper do app.html) -->
            <main class="main-content">
                <!-- Container (Wrapper do app.html) -->
                <div class="container mx-auto px-6 py-8">
                
                    <!-- CONTEÚDO ORIGINAL DO banco_horas.html INSERIDO AQUI -->
                    
                    <!-- NOVA VIEW: Dashboard -->
                    <div id="dashboardView" class="view-content active">
                        <div class="flex flex-wrap justify-between items-center mb-4 gap-4">
                            <h1><i data-feather="grid" class="h-7 w-7"></i> Dashboard Banco de Horas</h1>
                            <div class="text-sm text-gray-600">
                                <strong>Última Atualização:</strong>
                                <span id="lastUpdatedDash" class="font-medium" style="color: var(--accent);">Buscando...</span>
                            </div>
                        </div>

                        <!-- Filtros do Dashboard -->
                        <div class="filter-bar">
                            <div class="form-group">
                                <label for="filterRegionalDash">Filtrar por Regional</label>
                                <!-- MUDANÇA: de input para select -->
                                <select id="filterRegionalDash">
                                    <option value="">Todas as regionais</option>
                                    <!-- Opções serão populadas pelo JS -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="filterCodFilialDash">Filtrar por Cód. Filial</label>
                                <!-- MUDANÇA: de input para select -->
                                <select id="filterCodFilialDash">
                                    <option value="">Todas as filiais</option>
                                    <!-- Opções serão populadas pelo JS -->
                                </select>
                            </div>
                             <div class="form-group">
                                <label for="filterSecaoDash">Filtrar por Seção</label>
                                <!-- MUDANÇA: de input para select -->
                                <select id="filterSecaoDash">
                                    <option value="">Todas as seções</option>
                                    <!-- Opções serão populadas pelo JS -->
                                </select>
                            </div>
                             <div class="form-group">
                                <label for="filterFuncaoDash">Filtrar por Função</label>
                                <!-- MUDANÇA: de input para select -->
                                <select id="filterFuncaoDash">
                                    <option value="">Todas as funções</option>
                                    <!-- Opções serão populadas pelo JS -->
                                </select>
                            </div>
                        </div>

                        <!-- Cards de Estatísticas -->
                        <div class="stats-grid">
                            <!-- ATUALIZADO: Card com ícone -->
                            <div class="stat-card-dash flex items-start gap-4">
                                <div class="p-3 rounded-lg bg-blue-100 text-blue-600">
                                    <i data-feather="users" class="h-6 w-6"></i>
                                </div>
                                <div class="flex-1">
                                    <div class="stat-number" id="statTotalColab">0</div>
                                    <div class="stat-label">Colaboradores</div>
                                    <div class="stat-change" id="statChangeColab">
                                        <!-- Indicador de mudança -->
                                    </div>
                                </div>
                            </div>
                             <!-- ATUALIZADO: Card com ícone -->
                            <div class="stat-card-dash flex items-start gap-4">
                                <div class="p-3 rounded-lg bg-red-100 text-red-600">
                                    <i data-feather="clock" class="h-6 w-6"></i>
                                </div>
                                <div class="flex-1">
                                    <div class="stat-number" id="statTotalHoras">0</div>
                                    <div class="stat-label">Total de Horas</div>
                                    <div class="stat-change" id="statChangeHoras">
                                        <!-- Indicador de mudança -->
                                    </div>
                                </div>
                            </div>
                             <!-- ATUALIZADO: Card com ícone -->
                            <div class="stat-card-dash flex items-start gap-4">
                                <div class="p-3 rounded-lg bg-green-100 text-green-600">
                                    <i data-feather="dollar-sign" class="h-6 w-6"></i>
                                </div>
                                <div class="flex-1">
                                    <div class="stat-number" id="statTotalValor">R$ 0</div>
                                    <div class="stat-label">Valor Total (Pagamento)</div>
                                    <div class="stat-change" id="statChangeValor">
                                        <!-- Indicador de mudança -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Gráficos -->
                        <div class="report-grid">
                            <div class="chart-card">
                                <h3><i data-feather="pie-chart"></i> Resumo por Seção (Valor)</h3>
                                <p class="text-sm text-gray-500 -mt-4 mb-4">Top 10 seções com maior valor.</p>
                                <div class="chart-container-wrapper" style="height: 350px;">
                                    <canvas id="chartResumoSecao"></canvas>
                                </div>
                            </div>
                            <div class="chart-card">
                                <h3><i data-feather="pie-chart"></i> Resumo por Função (Valor)</h3>
                                <p class="text-sm text-gray-500 -mt-4 mb-4">Top 10 funções com maior valor.</p>
                                <div class="chart-container-wrapper" style="height: 350px;">
                                    <canvas id="chartResumoFuncao"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Ranking por Filial -->
                        <div class="info-card">
                            <h3><i data-feather="bar-chart-2"></i> Ranking por Filial (Não filtrado)</h3>
                            <div id="tableRankingContainer" class="table-container mt-4">
                                <table class="tabela" id="tableRankingFilial">
                                    <thead>
                                        <tr>
                                            <th>Filial</th>
                                            <th>Valor (Pagamento)</th>
                                            <th>Total de Horas</th>
                                            <th>Colaboradores</th>
                                            <th>Tendência (Valor)</th> <!-- NOVO -->
                                        </tr>
                                    </thead>
                                    <tbody id="tableRankingFilialBody">
                                        <!-- Dados serão preenchidos pelo JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- NOVO: Gráfico Comparativo -->
                        <div class="chart-card">
                            <h3><i data-feather="bar-chart-2"></i> Comparativo por Regional (Valor Atual vs. Anterior)</h3>
                            <p class="text-sm text-gray-500 -mt-4 mb-4">Compara o valor total do banco de horas por regional com a última importação.</p>
                            <div class="chart-container-wrapper" style="height: 350px;">
                                <canvas id="chartComparativoRegional"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- View: Acompanhamento (Agora não é mais a 'active' por padrão) -->
                    <div id="acompanhamentoView" class="view-content">
                        <!-- Data View Section - USANDO INFO-CARD -->
                        <div class="info-card">
                            <div class="flex flex-wrap justify-between items-center mb-4 gap-4">
                                <!-- Adaptado para não ter borda/padding inferior -->
                                <h3 class="!mb-0 !pb-0 !border-b-0"><i data-feather="clock" class="h-5 w-5 mr-2"></i> Acompanhamento do Banco de Horas</h3>
                                <div class="text-sm text-gray-600">
                                    <strong>Última Atualização:</strong>
                                    <span id="lastUpdated" class="font-medium" style="color: var(--accent);">Buscando...</span>
                                </div>
                            </div>

                            <!-- Filtros (Adaptados para o filter-bar do style.css) -->
                            <div class="filter-bar mt-4">
                                <div class="form-group">
                                    <label for="filterChapa">Filtrar por Chapa</label>
                                    <input type="text" id="filterChapa" placeholder="Digite a chapa...">
                                </div>
                                <div class="form-group">
                                    <label for="filterNome">Filtrar por Nome</label>
                                    <input type="text" id="filterNome" placeholder="Digite o nome...">
                                </div>
                                <div class="form-group">
                                    <label for="filterRegional">Filtrar por Regional</label>
                                    <!-- MUDANÇA: Adicionado 'list' e <datalist> -->
                                    <input type="text" id="filterRegional" placeholder="Digite ou selecione..." list="regionalList">
                                    <datalist id="regionalList">
                                        <!-- Opções serão populadas pelo JS -->
                                    </datalist>
                                </div>
                                <div class="form-group">
                                    <label for="filterCodFilial">Filtrar por Cód. Filial</label>
                                    <!-- MUDANÇA: Adicionado 'list' e <datalist> -->
                                    <input type="text" id="filterCodFilial" placeholder="Digite ou selecione..." list="filialList">
                                    <datalist id="filialList">
                                        <!-- Opções serão populadas pelo JS -->
                                    </datalist>
                                </div>
                            </div>

                            <!-- Tabela - USANDO TABLE-CONTAINER E TABELA -->
                            <div id="tableContainer" class="table-container mt-6">
                                <table class="tabela">
                                    <thead id="tableHead">
                                        <!-- Cabeçalho será gerado pelo JS -->
                                    </thead>
                                    <tbody id="tableBody">
                                        <tr><td colspan="13" class="text-center py-10 text-gray-500">Carregando dados...</td></tr>
                                    </tbody>
                                </table>
                            </div>
                            <p id="tableMessage" class="hidden text-center py-10 text-gray-500">Nenhum dado encontrado para os filtros aplicados.</p>
                        </div>
                    </div>

                    <!-- View: Configurações (Admin) -->
                    <div id="configuracoesView" class="view-content">
                        <!-- Admin Section - USANDO INFO-CARD (Movido para cá) -->
                        <div id="adminPanel" class="info-card mb-6"> <!-- Removido style="display: none;" -->
                            <h3><i data-feather="settings" class="h-5 w-5 mr-2"></i> Área Administrativa</h3>
                            <p class="text-gray-600 mb-4">Cole os dados do banco de horas abaixo (formato esperado: CSV ou separado por tabulação). A primeira linha deve ser o cabeçalho. Certifique-se de que os nomes das colunas correspondem: `REGIONAL`, `BANDEIRA`, `CODFILIAL`, `CHAPA`, `NOME`, `FUNCAO`, `SECAO`, `TOTAL_EM_HORA`, `TOTAL_NEGATIVO`, `VAL_PGTO_BHS`, `SITUACAO`, `Total Geral`.</p>
                            
                            <div id="importError" class="hidden alert alert-error mb-4" role="alert">
                                <strong class="font-bold">Erro na Importação:</strong>
                                <span class="block sm:inline" id="importErrorMessage"></span>
                            </div>

                            <!-- Aplicadas classes do style.css -->
                            <div class="form-group">
                                <label for="dataInput">Dados para importação:</label>
                                <textarea id="dataInput" class="w-full h-48" placeholder="Cole os dados aqui..."></textarea>
                            </div>
                            
                            <!-- BOTÕES ATUALIZADOS -->
                            <div class="flex items-center gap-4 mt-4">
                                <button id="previewButton" class="btn btn-info flex items-center gap-2">
                                    <i data-feather="search" class="h-5 w-5"></i>
                                    Pré-visualizar 15 Linhas
                                </button>
                                <button id="importButton" class="btn btn-success flex items-center gap-2">
                                    <i data-feather="upload" class="h-5 w-5"></i>
                                    Importar e Atualizar Dados
                                </button>
                            </div>
                            <p class="text-xs text-gray-500 mt-2"><strong>Atenção:</strong> A importação salvará os dados atuais no histórico e substituirá a base principal.</p>
                        
                            <!-- NOVO CONTAINER DA PRÉ-VISUALIZAÇÃO -->
                            <div id="previewContainer" class="mt-6" style="display: none;">
                                <h4 class="text-lg font-semibold text-gray-800 mb-2">Pré-visualização</h4>
                                <div id="previewTableContainer" class="table-container">
                                    <!-- A tabela de preview será injetada aqui -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- FIM DO CONTEÚDO ORIGINAL -->

                </div>
            </main>
        </div>
    </div>

    <!-- Container de Notificações (Padrão app.html) -->
    <div id="notificationContainer"></div>

    <!-- Modal Detalhes (Original do banco_horas.html, já compatível) -->
    <div id="detailsModal" class="modal">
        <div class="modal-content">
            <span id="modalClose" class="modal-close">&times;</span>
            <h3 id="modalTitle">Detalhes do Colaborador</h3>
            <div id="modalBody" class="space-y-4 mt-4">
                <p><strong>Nome:</strong> <span id="modalNome">...</span></p>
                <p><strong>Chapa:</strong> <span id="modalChapa">...</span></p>
                
                <hr>
                <h4 class="text-lg font-semibold text-gray-800">Comparativo da Atualização</h4>
                <div id="modalComparison">
                    <!-- Conteúdo do comparativo será injetado aqui -->
                </div>
                <div id="modalNoHistory" class="hidden text-gray-500 italic">
                    Nenhum histórico anterior encontrado para comparação.
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay (Padrão app.html) -->
    <div id="loading" class="loading">
        <div class="spinner"></div>
        <p id="loadingText">Processando...</p>
    </div>

    <!-- JS DO SISTEMA SEPARADO -->
    <!-- CORREÇÃO: Removido "banco_de_horas/" do caminho -->
    <script src="banco_horas.js" defer></script>
</body>
</html>

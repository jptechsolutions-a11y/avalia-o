<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Avaliação G&G</title>
    <link rel="icon" href="https://i.imgur.com/80SsE11.png" type="image/png">
    <meta name="theme-color" content="#011627">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gray-100">

    <div id="appShell" class="h-screen flex flex-col" style="display: none;">

        <header id="topBar" class="flex-shrink-0">
            <!-- ... (cabeçalho existente, sem alterações) ... -->
<!-- ... existing code ... -->
            <div class="flex items-center gap-4">
                <button id="sidebarToggle" class="btn-icon">
                    <i data-feather="menu" class="h-5 w-5"></i>
                </button>
<!-- ... existing code ... -->
                <div id="profileDropdownMenu" class="dropdown-menu">
                        <div class="px-4 py-3 border-b border-gray-600">
                            <span class="block text-sm font-medium text-white" id="dropdownUserName">...</span>
<!-- ... existing code ... -->
                            <span class="block text-xs text-gray-400" id="dropdownUserEmail">...</span>
                        </div>
                        <a href="#perfil" class="dropdown-item" onclick="window.GG.showView('perfilView', document.querySelector('a[href=\'#perfil\']'))">
                            <i data-feather="user" class="h-4 w-4 mr-2"></i> Meu Perfil
                        </a>
                        <a href="#configuracoes" class="dropdown-item" onclick="window.GG.showView('configuracoesView', document.querySelector('a[href=\'#configuracoes\']'))">
                            <i data-feather="settings" class="h-4 w-4 mr-2"></i> Configurações
                        </a>
                        <div class="border-t border-gray-600">
<!-- ... existing code ... -->
            <main class="main-content">
                <div class="container mx-auto px-6 py-8">

                    <!-- Conteúdo: Home -->
<!-- ... existing code ... -->
                        <div class="stats-grid">
                            <div class="stat-card-dash"> <div class="stat-number" id="totalAvaliacoesHome">0</div> <div class="stat-label">Avaliações</div> </div>
                            <div class="stat-card-dash"> <div class="stat-number" id="mediaGeralHome">0.0</div> <div class="stat-label">Média Geral</div> </div>
<!-- ... existing code ... -->
                            <div class="stat-card-dash"> <div class="stat-number" id="totalColaboradoresHome">0</div> <div class="stat-label">Colaboradores</div> </div>
                            <div class="stat-card-dash"> <div class="stat-number" id="totalGestoresHome">0</div> <div class="stat-label">Gestores (Avaliadores)</div> </div>
                        </div>
                    </div>

                    <!-- Conteúdo: Nova Avaliação -->
<!-- ... existing code ... -->
                                <button type="button" class="btn btn-secondary" onclick="window.GG.limparFormulario()"><i class="fas fa-undo"></i> Limpar</button>
                            </div>
                        </form>
                    </div>

                    <!-- Conteúdo: Histórico -->
<!-- ... existing code ... -->
                        <div style="text-align: center; margin-top: 20px;">
                            <button type="button" class="btn btn-warning" onclick="window.GG.exportarDados()"><i class="fas fa-download"></i> Exportar Visão</button>
                        </div>
                    </div>

                    <!-- Conteúdo: Relatórios -->
<!-- ... existing code ... -->
                        <h1><i class="fas fa-chart-bar"></i> Relatórios</h1>
                        <p>Seção de relatórios em desenvolvimento.</p>
                    </div>

                    <!-- Conteúdo: Configurações -->
                    <div id="configuracoesView" class="view-content">
                        <div id="accessStatusConfig" class="access-status" style="display: none;"></div>
                        <h1><i class="fas fa-cogs"></i> Configurações do Sistema</h1>
                        
                        <!-- Conteúdo visível apenas para Admins -->
                        <div id="configAdminOnly" style="display: none;">
                            <div class="alert alert-warning"><i class="fas fa-exclamation-triangle"></i> Acesso restrito a administradores.</div>

                            <!-- INÍCIO DA NOVA ESTRUTURA DE ABAS -->
                            <div class="config-tabs">
                                <a href="#" class="tab-link active" onclick="window.GG.showConfigTab('colaboradores', this)">
                                    <i data-feather="briefcase" class="h-4 w-4 mr-2"></i> Colaboradores & Gestores
                                </a>
                                <a href="#" class="tab-link" onclick="window.GG.showConfigTab('usuarios', this)">
                                    <i data-feather="users" class="h-4 w-4 mr-2"></i> Usuários do Sistema
                                </a>
                                <a href="#" class="tab-link" onclick="window.GG.showConfigTab('indicadores', this)">
                                    <i data-feather="target" class="h-4 w-4 mr-2"></i> Indicadores & Metas
                                </a>
                            </div>
                            <!-- FIM DA NOVA ESTRUTURA DE ABAS -->

                            <!-- INÍCIO DO CONTEÚDO DAS ABAS -->

                            <!-- ABA 1: COLABORADORES E GESTORES (NOVO) -->
                            <div id="tab-colaboradores" class="tab-content active">
                                
                                <div class="info-card">
                                    <h3><i class="fas fa-briefcase"></i> Gerenciar Colaboradores</h3>
                                    <form id="form-add-colaborador" onsubmit="event.preventDefault(); window.GG.salvarColaborador();">
                                        <h4>Adicionar/Editar Colaborador</h4>
                                        <input type="hidden" id="edit-colaborador-id">
                                        <div class="form-row">
                                            <div class="form-group"><label for="add-colaborador-nome">Nome *</label><input type="text" id="add-colaborador-nome" required></div>
                                            <div class="form-group"><label for="add-colaborador-matricula">Matrícula *</label><input type="text" id="add-colaborador-matricula" required></div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group"><label for="add-colaborador-funcao">Função</label><input type="text" id="add-colaborador-funcao"></div>
                                            <div class="form-group"><label for="add-colaborador-filial">Filial</label><input type="text" id="add-colaborador-filial" placeholder="Ex: 101, 205..."></div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group"><label for="add-colaborador-secao">Seção</label><input type="text" id="add-colaborador-secao" placeholder="Ex: OPERACIONAL, ADM..."></div>
                                            <div class="form-group">
                                                <label for="add-colaborador-status">Status</label>
                                                <select id="add-colaborador-status" required>
                                                    <option value="ativo">Ativo</option>
                                                    <option value="inativo">Inativo</option>
                                                    <option value="aviso">Aviso Prévio</option>
                                                    <option value="demitido">Demitido</option>
                                                </select>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Salvar Colaborador</button>
                                        <button type="button" class="btn btn-secondary" onclick="window.GG.limparFormColaborador()"><i class="fas fa-undo"></i> Limpar</button>
                                    </form>
                                    <hr>
                                    <h4>Colaboradores Cadastrados</h4>
                                    <div class="table-container">
                                        <table class="tabela" id="tabela-colaboradores-admin">
                                            <thead><tr><th>Nome</th><th>Matrícula</th><th>Função</th><th>Filial</th><th>Seção</th><th>Status</th><th>Ações</th></tr></thead>
                                            <tbody><tr><td colspan="7" style="text-align:center;">Carregando...</td></tr></tbody>
                                        </table>
                                    </div>
                                </div>
                                
                                <div class="info-card">
                                    <h3><i class="fas fa-user-tie"></i> Gerenciar Gestores</h3>
                                    <form id="form-add-gestor" onsubmit="event.preventDefault(); window.GG.salvarGestor();">
                                        <h4>Adicionar/Editar Gestor</h4>
                                        <input type="hidden" id="edit-gestor-id">
                                        <div class="form-row">
                                            <div class="form-group"><label for="add-gestor-nome">Nome *</label><input type="text" id="add-gestor-nome" required></div>
                                            <div class="form-group"><label for="add-gestor-matricula">Matrícula *</label><input type="text" id="add-gestor-matricula" required></div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label for="add-gestor-status">Status</label>
                                                <select id="add-gestor-status" required>
                                                    <option value="ativo">Ativo</option>
                                                    <option value="inativo">Inativo</option>
                                                </select>
                                            </div>
                                            <div class="form-group"></div>
                                        </div>
                                        <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Salvar Gestor</button>
                                        <button type="button" class="btn btn-secondary" onclick="window.GG.limparFormGestor()"><i class="fas fa-undo"></i> Limpar</button>
                                    </form>
                                    <hr>
                                    <h4>Gestores Cadastrados</h4>
                                    <div class="table-container">
                                        <table class="tabela" id="tabela-gestores-admin">
                                            <thead><tr><th>Nome</th><th>Matrícula</th><th>Status</th><th>Ações</th></tr></thead>
                                            <tbody><tr><td colspan="4" style="text-align:center;">Carregando...</td></tr></tbody>
                                        </table>
                                    </div>
                                </div>

                            </div>

                            <!-- ABA 2: USUÁRIOS DO SISTEMA (Conteúdo Movido) -->
                            <div id="tab-usuarios" class="tab-content">
                                <div class="info-card">
                                    <h3><i class="fas fa-inbox"></i> Solicitações de Acesso Pendentes</h3>
                                    <div class="table-container">
                                        <table class="tabela" id="tabela-solicitacoes-admin">
                                            <thead><tr><th>Nome</th><th>E-mail</th><th>Motivo</th><th>Data</th><th>Ações</th></tr></thead>
                                            <tbody><tr><td colspan="5" style="text-align:center;">Carregando...</td></tr></tbody>
                                        </table>
                                    </div>
                                </div>

                                <div class="info-card">
                                    <h3><i class="fas fa-users-cog"></i> Gerenciar Usuários do Sistema</h3>
                                    <div class="table-container">
                                        <table class="tabela" id="tabela-usuarios-admin">
                                            <thead><tr><th>Nome</th><th>E-mail</th><th>Matrícula</th><th>Permissão (Role)</th><th>Filial</th><th>Status</th><th>Ações</th></tr></thead>
                                            <tbody><tr><td colspan="7" style="text-align:center;">Carregando usuários...</td></tr></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <!-- ABA 3: INDICADORES (Conteúdo Movido) -->
                            <div id="tab-indicadores" class="tab-content">
                                <!-- CARD: Cadastrar Novo Indicador -->
                                <div class="info-card">
                                    <h3><i class="fas fa-plus-circle"></i> Cadastrar Novo Indicador</h3>
                                    <form id="form-add-indicador" onsubmit="event.preventDefault(); window.GG.salvarIndicador();">
                                        <input type="hidden" id="edit-indicador-id">
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label for="add-indicador-nome">Nome do Indicador *</label>
                                                <input type="text" id="add-indicador-nome" required>
                                            </div>
                                            <div class="form-group">
                                                <label for="add-indicador-secao">Seção *</label>
                                                <select id="add-indicador-secao" required>
                                                    <option value="">Carregando seções...</option>
                                                </select>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Salvar Indicador</button>
                                        <button type="button" class="btn btn-secondary" onclick="window.GG.limparFormIndicador()"><i class="fas fa-undo"></i> Limpar</button>
                                    </form>
                                    <hr>
                                    <h4>Indicadores Cadastrados (Definições)</h4>
                                    <div class="table-container">
                                        <table class="tabela" id="tabela-indicadores">
                                            <thead><tr><th>ID</th><th>Indicador</th><th>Seção</th><th>Ações</th></tr></thead>
                                            <tbody><tr><td colspan="4" style="text-align:center;">Carregando...</td></tr></tbody>
                                        </table>
                                    </div>
                                </div>

                                <!-- CARD: Gerenciar Metas -->
                                <div class="info-card">
                                    <h3><i class="fas fa-list-alt"></i> Gerenciar Metas por Filial</h3>
                                    <form id="form-add-meta" onsubmit="event.preventDefault(); window.GG.salvarMeta();">
                                        <h4>Adicionar/Editar Meta</h4>
                                        <input type="hidden" id="edit-meta-id">
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label for="add-meta-indicador">Indicador *</label>
                                                <select id="add-meta-indicador" required>
                                                    <option value="">Selecione...</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="add-meta-filial">Filial *</label>
                                                <select id="add-meta-filial" required>
                                                    <option value="">Carregando filiais...</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label for="add-meta-meta">Meta *</label>
                                                <input type="text" id="add-meta-meta" required placeholder="Ex: >= 80, < 5%">
                                            </div>
                                            <div class="form-group">
                                                <label for="add-meta-tipo">Tipo *</label>
                                                <select id="add-meta-tipo" required>
                                                    <option value="">Selecione o Tipo...</option>
                                                </select>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Salvar Meta</button>
                                        <button type="button" class="btn btn-secondary" onclick="window.GG.limparFormMeta()"><i class="fas fa-undo"></i> Limpar</button>
                                    </form>
                                    <hr>
                                    <h4>Metas Cadastradas</h4>
                                    <div class="table-container">
                                        <table class="tabela" id="tabela-metas">
                                            <thead><tr><th>ID</th><th>Indicador</th><th>Filial</th><th>Meta</th><th>Tipo</th><th>Ações</th></tr></thead>
                                            <tbody><tr><td colspan="6" style="text-align:center;">Carregando...</td></tr></tbody>
                                        </table>
                                    </div>
                                </div>

                                <!-- CARD: Gerenciar Resultados -->
                                <div class="info-card">
                                    <h3><i class="fas fa-calendar-check"></i> Gerenciar Resultados Mensais</h3>
                                    <form id="form-add-resultado" onsubmit="event.preventDefault(); window.GG.adicionarOuAtualizarResultado();">
                                        <h4>Adicionar/Atualizar Resultado</h4>
                                        <input type="hidden" id="edit-resultado-id">
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label for="add-resultado-indicador">Indicador *</label>
                                                <select id="add-resultado-indicador" required><option value="">Carregando...</option></select>
                                            </div>
                                            <div class="form-group">
                                                <label for="add-resultado-filial">Filial *</label>
                                                <select id="add-resultado-filial" required><option value="">Carregando...</option></select>
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label for="add-resultado-mes">Mês de Referência *</label>
                                                <input type="month" id="add-resultado-mes" required>
                                            </div>
                                            <div class="form-group">
                                                <label for="add-resultado-valor">Valor Realizado *</label>
                                                <input type="text" id="add-resultado-valor" required placeholder="Ex: 85.5, 1.2%, R$1000">
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Salvar Resultado</button>
                                        <button type="button" class="btn btn-secondary" onclick="window.GG.limparFormResultado()"><i class="fas fa-undo"></i> Limpar</button>
                                    </form>
                                    <hr>
                                    <h4>Resultados Cadastrados</h4>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="filtro-resultado-mes">Filtrar por Mês:</label>
                                            <input type="month" id="filtro-resultado-mes" onchange="window.GG.renderizarTabelaResultados()">
                                        </div>
                                        <div class="form-group">
                                            <label for="filtro-resultado-filial">Filtrar por Filial:</label>
                                            <select id="filtro-resultado-filial" onchange="window.GG.renderizarTabelaResultados()"><option value="">Todas</option></select>
                                        </div>
                                    </div>
                                    <div class="table-container">
                                        <table class="tabela" id="tabela-resultados">
                                            <thead><tr><th>Mês</th><th>Filial</th><th>Indicador</th><th>Realizado</th><th>Ações</th></tr></thead>
                                            <tbody><tr><td colspan="5" style="text-align:center;">Selecione filtros para carregar...</td></tr></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <!-- FIM DO CONTEÚDO DAS ABAS -->

                        </div>
                         <div id="configUserOnly" class="alert alert-info" style="display: none;">
                            Você não tem permissão de administrador para ver esta página.
                        </div>
                    </div>
                    
                    <!-- Conteúdo: Perfil -->
<!-- ... existing code ... -->
            <input type="hidden" id="editItemId">
            <input type="hidden" id="editItemType">
            <div id="modalFields"></div>
<!-- ... existing code ... -->
        </form>
       </div>
     </div>
     
     <!-- NOVO: Modal de Edição de Usuário -->
<!-- ... existing code ... -->
            <input type="hidden" id="modal-user-id">
            <div class="form-row">
                <div class="form-group">
<!-- ... existing code ... -->
                    <label for="modal-user-status">Status</label>
                     <select id="modal-user-status">
                        <option value="ativo">Ativo</option>
                        <option value="inativo">Inativo</option>
                    </select>
                </div>
            </div>
            
            <!-- Adicionar campo para permissoes_filiais (array) se necessário no futuro -->
            
            <div class="flex justify-end gap-4 mt-6">
                <button type="submit" class="btn btn-success">
                    <i data-feather="save" class="h-4 w-4 mr-2"></i> Salvar
                </button>
                <button type="button" class="btn btn-secondary" onclick="window.GG.fecharModalUsuario()">
                    Cancelar
                </button>
            </div>
        </form>
       </div>
     </div>


    <script src="script.js"></script>
    <script>
        feather.replace();
    </script>
</body>
</html>

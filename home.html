<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seleção de Sistema | G&G</title>
    <link rel="icon" href="icon.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary: #00D4AA;
            --secondary: #00B4D8;
            --accent: #0077B6;
            --dark: #023047;
            --darker: #011627;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--darker);
        }
        .card-hover {
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }
        .card-hover:hover {
            transform: translateY(-8px);
            box-shadow: 0 10px 20px rgba(0, 212, 170, 0.1);
            border-color: var(--primary);
        }
        .card-icon {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border-radius: 0.75rem;
            padding: 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
        }
        /* Estilo específico para o novo card de Pendências (usando o accent) */
        .card-icon-pendencias {
            background: linear-gradient(135deg, #FF6F61 0%, #D83B5E 100%); /* Um gradiente de vermelho/rosa para alerta */
            color: white;
            border-radius: 0.75rem;
            padding: 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
        }
        .card-hover:hover .card-icon-pendencias {
            box-shadow: 0 10px 20px rgba(255, 111, 97, 0.2);
        }
        /* NOVO: Estilo para o Card "Área do Gestor" (usando a cor --accent) */
        .card-icon-gestor {
            background: linear-gradient(135deg, var(--accent) 0%, var(--dark) 100%);
            color: white;
            border-radius: 0.75rem;
            padding: 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
        }
        .card-hover:hover .card-icon-gestor {
            box-shadow: 0 10px 20px rgba(0, 119, 182, 0.2);
        }
        
        /* NOVOS ESTILOS PARA OS NOVOS CARDS */
        .card-icon-perfil {
            background: linear-gradient(135deg, #6d28d9 0%, #4f46e5 100%); /* Roxo/Indigo */
            color: white;
            border-radius: 0.75rem;
            padding: 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
        }
         .card-hover:hover .card-icon-perfil {
            box-shadow: 0 10px 20px rgba(109, 40, 217, 0.2);
        }
        
        .card-icon-admin {
            background: linear-gradient(135deg, #f59e0b 0%, #e11d48 100%); /* Amarelo/Rosa */
            color: white;
            border-radius: 0.75rem;
            padding: 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
        }
         .card-hover:hover .card-icon-admin {
            box-shadow: 0 10px 20px rgba(225, 29, 72, 0.2);
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-6 text-white">

    <header class="absolute top-0 left-0 right-0 p-6 flex justify-between items-center">
        <img src="icon.png" alt="Logo G&G" class="h-10 w-auto">
        <button onclick="logout()" class="flex items-center gap-2 text-gray-400 hover:text-white transition-colors duration-200">
            <i data-feather="log-out" class="h-5 w-5"></i>
            Sair
        </button>
    </header>

    <main class="text-center">
        <h1 class="text-4xl font-bold mb-4">Bem-vindo, <span id="userName">Usuário</span>.</h1>
        <p class="text-xl text-gray-300 mb-12">Selecione o sistema que deseja acessar:</p>

        <!-- MUDANÇA: Grid atualizado para 3 colunas em 'lg' -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 max-w-7xl mx-auto">
            
            <!-- Card 1: Avaliação de Desempenho -->
            <a href="app.html" class="card-hover bg-gray-800 rounded-xl p-8 text-left">
                <div class="card-icon">
                    <i data-feather="clipboard" class="h-8 w-8"></i>
                </div>
                <h2 class="text-2xl font-semibold mb-2">Avaliação de Desempenho</h2>
                <p class="text-gray-400 mb-6">Registrar e consultar avaliações de desempenho dos colaboradores.</p>
                <span class="font-semibold text-primary hover:text-secondary transition-colors duration-200">Acessar Sistema &rarr;</span>
            </a>

            <!-- Card 2: Banco de Horas -->
            <a href="banco_de_horas/banco_horas.html" class="card-hover bg-gray-800 rounded-xl p-8 text-left">
                <div class="card-icon">
                    <i data-feather="clock" class="h-8 w-8"></i>
                </div>
                <h2 class="text-2xl font-semibold mb-2">Banco de Horas</h2>
                <p class="text-gray-400 mb-6">Consultar, gerenciar e atualizar o banco de horas dos colaboradores.</p>
                <span class="font-semibold text-primary hover:text-secondary transition-colors duration-200">Acessar Sistema &rarr;</span>
            </a>
            
            <!-- Card 3: Pendência de Documentos -->
            <a href="pendencias_documentos/pendencias.html" class="card-hover bg-gray-800 rounded-xl p-8 text-left">
                <div class="card-icon-pendencias">
                    <i data-feather="alert-triangle" class="h-8 w-8"></i>
                </div>
                <h2 class="text-2xl font-semibold mb-2">Pendência de Documentos</h2>
                <p class="text-gray-400 mb-6">Acompanhar o status de assinaturas e pendências por filial e mês.</p>
                <span class="font-semibold" style="color: #FF6F61;">Acessar Sistema &rarr;</span>
            </a>

            <!-- Card 4: Área do Gestor -->
            <a href="area_gestor/index.html" class="card-hover bg-gray-800 rounded-xl p-8 text-left">
                <div class="card-icon-gestor">
                    <i data-feather="briefcase" class="h-8 w-8"></i>
                </div>
                <h2 class="text-2xl font-semibold mb-2">Área do Gestor</h2>
                <p class="text-gray-400 mb-6">Gerenciar seu time, definir hierarquias e acompanhar o status dos colaboradores.</p>
                <span class="font-semibold" style="color: var(--accent);">Acessar Sistema &rarr;</span>
            </a>
            
            <!-- NOVO CARD 5: Meu Perfil -->
            <a href="app.html#perfil" class="card-hover bg-gray-800 rounded-xl p-8 text-left">
                <div class="card-icon-perfil">
                    <i data-feather="user" class="h-8 w-8"></i>
                </div>
                <h2 class="text-2xl font-semibold mb-2">Meu Perfil</h2>
                <p class="text-gray-400 mb-6">Atualize seu nome, foto de perfil e matrícula no sistema.</p>
                <span class="font-semibold" style="color: #8b5cf6;">Acessar Perfil &rarr;</span>
            </a>
            
            <!-- NOVO CARD 6: Gerenciar Usuários (Admin) -->
            <a id="admin-card-usuarios" href="app.html#configuracoes" class="card-hover bg-gray-800 rounded-xl p-8 text-left" style="display: none;">
                <div class="card-icon-admin">
                    <i data-feather="users" class="h-8 w-8"></i>
                </div>
                <h2 class="text-2xl font-semibold mb-2">Gerenciar Usuários</h2>
                <p class="text-gray-400 mb-6">(Admin) Aprove acessos, edite permissões e status dos usuários.</p>
                <span class="font-semibold" style="color: #f59e0b;">Acessar Config. &rarr;</span>
            </a>

        </div>
    </main>

    <footer class="absolute bottom-0 p-6 text-gray-500 text-sm">
        &copy; 2025 - Sistema G&G | Desenvolvido por @ Juliano Patrick
    </footer>

    <script>
        const SUPABASE_URL = 'https://xizamzncvtacaunhmsrv.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhpemFtem5jdnRhY2F1bmhtc3J2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE4NTM3MTQsImV4cCI6MjA3NzQyOTcxNH0.tNZhQiPlpQCeFTKyahFOq_q-5i3_94AHpmIjYYrnTc8';
        
        let supabaseClient = null;

        // Define o adaptador para sessionStorage
        const sessionStorageAdapter = {
          getItem: (key) => sessionStorage.getItem(key),
          setItem: (key, value) => sessionStorage.setItem(key, value),
          removeItem: (key) => sessionStorage.removeItem(key),
        };

        try {
             supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
                auth: {
                    storage: sessionStorageAdapter,
                    persistSession: true,
                    autoRefreshToken: true
                }
            });
        } catch (e) {
            console.error("Erro ao inicializar Supabase:", e);
        }

        async function getUserProfile() {
            if (!supabaseClient) {
                 console.error("Supabase client não inicializado.");
                 return;
            }

            try {
                const { data: { session }, error: sessionError } = await supabaseClient.auth.getSession();
                if (sessionError || !session) {
                    console.error("Sem sessão, redirecionando para login.", sessionError);
                    window.location.href = 'index.html';
                    return;
                }

                const user = session.user;
                
                // ATUALIZADO: Buscar 'nome' e 'role'
                const { data: profile, error: profileError } = await supabaseClient
                    .from('usuarios')
                    .select('nome, role') // Pede o 'role'
                    .eq('auth_user_id', user.id)
                    .single();

                if (profileError) {
                    console.warn("Erro ao buscar perfil, usando nome do email:", profileError.message);
                }

                const userName = profile?.nome || user.email.split('@')[0] || 'Usuário';
                document.getElementById('userName').textContent = userName;

                // NOVO: Verificar se é admin para mostrar o card
                if (profile?.role === 'admin') {
                    const adminCard = document.getElementById('admin-card-usuarios');
                    if (adminCard) {
                        adminCard.style.display = 'block';
                    }
                }

            } catch (e) {
                console.error("Erro ao buscar dados do usuário:", e);
                window.location.href = 'index.html';
            }
        }

        function logout() {
            if (supabaseClient) {
                supabaseClient.auth.signOut().then(() => {
                    window.location.href = 'index.html';
                }).catch((error) => {
                    console.error("Erro ao sair:", error);
                    window.location.href = 'index.html';
                });
            } else {
                 window.location.href = 'index.html';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            feather.replace();
            getUserProfile();
        });
    </script>
</body>
</html>
